import os
from telethon import TelegramClient, events
import asyncio
import re
from telethon.tl.functions.channels import EditBannedRequest, GetParticipantRequest
from telethon.tl.types import ChatBannedRights, ChannelParticipantAdmin, ChannelParticipantCreator
import asyncio
import re
from telethon import events
from telethon.tl.functions.channels import EditBannedRequest, GetParticipantRequest
from telethon.tl.types import ChatBannedRights, ChannelParticipantAdmin, ChannelParticipantCreator
# Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª API Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©
api_id = os.getenv('API_ID')      
api_hash = os.getenv('API_HASH')  
bot_token = os.getenv('BOT_TOKEN')
ABH = TelegramClient('code', api_id, api_hash).start(bot_token=bot_token)

banned_words = [
    "Ø®Ø±Ø¨ Ø¯ÙŠÙ†Ù‡", "ÙƒØ³Ùƒ", "ÙƒØ³Ù‡", "ÙƒØ³Ø©", "Ø§ÙƒØ­Ø§Ø¨", "Ø£ÙƒØ­Ø§Ø¨", "Ø²Ù†Ø§", "ÙƒÙˆÙ… Ø¨ÙŠ", "ÙƒÙ…Ø¨ÙŠ", "Ø§Ø±Ù‚Ø© Ø¬Ø§ÙŠ", 
    "Ø§Ø±Ù‚Ù‡ Ø¬Ø§ÙŠ", "ÙŠÙ…ÙˆØ·", "ØªÙ…ÙˆØ·", "Ù…ÙˆØ·Ù„ÙŠ", "Ø§Ù…ÙˆØ·", "Ø¨ÙˆØ±Ù†", "Ø§Ù„ÙØ±Ø®", "Ø§Ù„ÙØ±Ø­Ù’", "ØªÙŠØ²", "ÙƒØ³Ù…",
    "Ø³ÙƒØ³ÙŠ", "ÙƒØ­Ø§Ø¨", "Ù…Ù†Ø§ÙˆÙŠØ¬", "Ù…Ù†ÙŠÙˆØ¬", "Ø¹ÙŠÙˆØ±Ø©", "Ø¹ÙŠÙˆØ±ØªÙƒÙ…", "Ø§Ù†ÙŠØ¬Ø©", "Ø§Ù†ÙŠÚ†Ø©", "Ø§Ù†ÙŠØ¬Ù‡", 
    "Ù…Ø§ÙŠØ§", "Ù…Ø§ÙŠØ©", "Ù…Ø§ÙŠÙ‡", "Ø¨ÙƒØ³Ù…Ùƒ", "Ø¨ÙƒØ³Ø®ØªÙƒ", "ğŸ‘", "Ù†ØºÙ„", "Ù†ØºÙˆÙ„Ø©", "Ù†ØºÙˆÙ„Ù‡", "ÙŠÙ†ØºÙ„", 
    "Ø§Ù†ÙŠÚ†Ù‡", "Ø£Ù†Ø§Ø¬", "Ø§Ù†Ø§Ø¬", "Ø§Ù†ÙŠØ¬", "Ø£Ù†ÙŠØ¬", "ÙØ±ÙŠØ®", "ÙØ±ÙŠØ®Ø©", "ÙØ±ÙŠØ®Ù‡", "ÙØ±Ø®ÙŠ","Ù‚Ø¶ÙŠØ¨", 
    "ÙƒØ³", "Ø¹ÙŠØ±", "ÙƒØ³Ù…Ùƒ", "ÙƒØ³Ø®ØªÙƒ", "ÙƒØ³ Ø§Ù…Ùƒ", "Ø·ÙŠØ²", "Ø·ÙŠØ²Ùƒ", "ÙØ±Ø®", "ÙƒÙˆØ§Ø¯", "Ø§Ø®Ù„ÙƒØ­Ø¨Ø©", 
    "Ø§ÙŠÙ†ÙŠØ¬", "Ø¨Ø±Ø¨ÙˆÙƒ", "Ø²Ø¨", "Ø·ÙŠØ²Ù‡Ø§", "Ø¹ÙŠØ±ÙŠ", "Ø®Ø±Ø¨ Ø§Ù„Ù„Ù‡", "Ø§Ù„Ø¹ÙŠØ±", "Ø¨Ø¹ÙŠØ±ÙŠ", "ÙƒØ­Ø¨Ù‡", 
    "Ø¨Ø±Ø§Ø¨ÙŠÙƒ", "Ù†ÙŠØ¬Ù†ÙŠ", "Ù†ÙŠÚ†Ù†ÙŠ", "Ù†ÙˆØ¯Ø²", "Ù†ØªÙ„Ø§ÙˆØ·", "Ù„ÙˆØ§Ø·", "Ù„ÙˆØ·ÙŠ", "ÙØ±ÙˆØ®", "Ù…Ù†ÙŠÙˆÙƒ", 
    "Ø§Ù†ÙŠØ¬Ùƒ", "Ù†ÙŠØ¬Ùƒ", "ÙƒØ­Ø¨Ø©", "Ø§Ø¨Ù† Ø§Ù„ÙƒØ­Ø¨Ø©", "Ø§Ø¨Ù† Ø§Ù„ÙƒØ­Ø¨Ù‡", "ØªÙ†ÙŠØ¬", "Ø§ØªÙ†ÙŠØ¬", "ÙŠÙ†ÙŠØ¬", "Ø³Ø¨"
]

# Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© ÙÙŠ Ø§Ù„Ø£Ø­Ø±Ù
normalized_banned_words = {word: re.sub(r'(.)\1+', r'\1', word) for word in banned_words}

def normalize_text(text):
    """ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ù„ÙŠÙƒÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚Ù‹Ø§ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¸Ø±"""
    text = text.lower()
    text = re.sub(r'[^Ø£-ÙŠa-zA-Z\s]', '', text)  # Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø±Ù…ÙˆØ² ØºÙŠØ± Ø§Ù„Ø£Ø­Ø±Ù ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª
    replace_map = {'Ø£': 'Ø§', 'Ø¥': 'Ø§', 'Ø¢': 'Ø§', 'Ù‰': 'ÙŠ', 'Ø¤': 'Ùˆ', 'Ø¦': 'ÙŠ'}
    for old, new in replace_map.items():
        text = text.replace(old, new)
    text = re.sub(r'(.)\1+', r'\1', text)  # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØªØ§Ø¨Ø¹Ø© ÙÙŠ Ø§Ù„Ø­Ø±ÙˆÙ
    return text

async def is_admin(chat, user_id):
    """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´Ø±ÙÙ‹Ø§ Ø£Ùˆ Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©"""
    try:
        participant = await ABH(GetParticipantRequest(chat, user_id))
        return isinstance(participant.participant, (ChannelParticipantAdmin, ChannelParticipantCreator))
    except:
        return False

def check_message(message):
    """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©"""
    normalized_message = normalize_text(message)
    words = normalized_message.split()
    return any(word in normalized_banned_words.values() for word in words)

@ABH.on(events.NewMessage)
async def handler_res(event):
    if event.is_group:
        message_text = event.raw_text.strip()
        user_id = event.sender_id
        chat = await event.get_chat()
        
        if check_message(message_text):  # Ø¥Ø°Ø§ Ø§Ø­ØªÙˆØª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©
            if await is_admin(chat, user_id):  # Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¡ Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ†ØŒ ÙÙ‚Ø· Ø§Ø­Ø°Ù Ø±Ø³Ø§Ù„ØªÙ‡Ù…
                await event.delete()
                return
            
            # Ø¥Ø¹Ø¯Ø§Ø¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙŠÙŠØ¯
            restrict_rights = ChatBannedRights(
                until_date=None,
                send_messages=True, 
                send_media=True,
                send_stickers=True,
                send_gifs=True,
                send_games=True,
                send_inline=True,
                embed_links=True
            )
            
            unrestrict_rights = ChatBannedRights(
                until_date=None,
                send_messages=False, 
                send_media=False,
                send_stickers=False,
                send_gifs=False,
                send_games=False,
                send_inline=False,
                embed_links=False
            )
            
            try:
                await ABH(EditBannedRequest(chat.id, user_id, restrict_rights))  # ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await event.delete()  # Ø­Ø°Ù Ø±Ø³Ø§Ù„ØªÙ‡
                await asyncio.sleep(20 * 60)  # Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 20 Ø¯Ù‚ÙŠÙ‚Ø©
                await ABH(EditBannedRequest(chat.id, user_id, unrestrict_rights))  # ÙÙƒ Ø§Ù„ØªÙ‚ÙŠÙŠØ¯

            except Exception as e:
                print(f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {e}")

ABH.run_until_disconnected()
