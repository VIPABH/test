from telethon import TelegramClient, events
from telethon.tl import EditBannedRequest
import os
import re

# ุฌูุจ ุงูุจูุงูุงุช ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
api_id = int(os.getenv('API_ID'))      
api_hash = os.getenv('API_HASH')  
bot_token = os.getenv('BOT_TOKEN') 

# ุชุดุบูู ุงูุจูุช
ABH = TelegramClient('bot', api_id, api_hash).start(bot_token=bot_token)

# ูุงุฆูุฉ ุงููููุงุช ุงููุญุธูุฑุฉ
banned_words = [
    "ุณุจ", "ูุณ", "ุนูุฑ", "ูุณูู", "ูุณุฎุชู", "ูุณ ุงูู", "ุทูุฒ", "ุทูุฒู", "ูุฑุฎ", "ููุงุฏ", 
    "ุงููุฌู", "ููุฌู", "ูุญุจุฉ", "ุงุจู ุงููุญุจุฉ", "ุงุจู ุงููุญุจู", "ุชููุฌ", "ุงุชููุฌ", "ูููุฌ", 
    "ุงูููุฌ", "ุจุฑุจูู", "ุฒุจ", "ุทูุฒูุง", "ุนูุฑู", "ุฎุฑุจ ุงููู", "ุงูุนูุฑ", "ุจุนูุฑู", "ูุญุจู", 
    "ุจุฑุงุจูู", "ููุฌูู", "ููฺูู", "ููุฏุฒ", "ูุชูุงูุท", "ููุงุท", "ููุทู", "ูุฑูุฎ", "ููููู", 
    "ูุงูุง", "ูุงูุฉ", "ูุงูู", "ุจูุณูู", "ุจูุณุฎุชู", "๐", "ูุบู", "ูุบููุฉ", "ูุบููู", "ููุบู", 
    "ุณูุณู", "ูุญุงุจ", "ููุงููุฌ", "ููููุฌ", "ุนููุฑุฉ", "ุนููุฑุชูู", "ุงููุฌุฉ", "ุงููฺุฉ", "ุงููุฌู", 
    "ุงููฺู", "ุฃูุงุฌ", "ุงูุงุฌ", "ุงููุฌ", "ุฃููุฌ", "ูุฑูุฎ", "ูุฑูุฎุฉ", "ูุฑูุฎู", "ูุฑุฎู", "๐", 
    "๐", "ูุณู", "ูุณู", "ูุณุฉ", "ุงูุญุงุจ", "ุฃูุญุงุจ", "ุฒูุง", "ููู ุจู", "ููุจู", "ุงุฑูุฉ ุฌุงู", 
    "ุงุฑูู ุฌุงู", "ูููุท", "ุชููุท", "ููุทูู", "ุงููุท", "ุจูุฑู", "ุงููุฑุฎ", "ุงููุฑุญู", "ุชูุฒ", "ูุณู"
]  # ุฅุถุงูุฉ ุงููููุงุช ุงููุญุธูุฑุฉ

def normalize_text(text):
    """ุฅุฒุงูุฉ ูู ุดูุก ุนุฏุง ุงูุฃุญุฑู ูุน ุฅุฒุงูุฉ ุงูุฃุฑูุงู ูุงูุญุฑูู 'ู' ู 'ู'"""
    # ุฅุฒุงูุฉ ุฃู ุดูุก ุบูุฑ ุญุฑู ุฃู ุงูุฃุฑูุงู
    text = re.sub(r'[^ุฃ-ูa-zA-Z]', '', text)  # ุฅุฒุงูุฉ ูู ุดูุก ุนุฏุง ุงูุญุฑูู ูุงูุฃุญุฑู
    # ุฅุฒุงูุฉ ูุฌููุนุฉ ูู ุงูุฃุญุฑู ุจูุง ูููุง 'ฺค'
    remove_chars = ['ูพ', 'ฺค', 'ูู', 'ฺ', 'ฺฏ', 'ุฃ', 'ุฅ', 'ุข', 'ุฆ', 'ฺ']
    for char in remove_chars:
        text = text.replace(char, '')  # ุฅุฒุงูุฉ ุงูุญุฑูู ุงููุญุฏุฏุฉ
    text = text.replace('ู', '')  # ุฅุฒุงูุฉ ุงูุญุฑู 'ู'
    text = text.replace('ู', '')  # ุฅุฒุงูุฉ ุงูุญุฑู 'ู'
    text = re.sub(r'(.)\1+', r'\1', text)  # ุฅุฒุงูุฉ ุงูุญุฑูู ุงูููุฑุฑุฉ
    return text

def check_message(message):
    """ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ุชุญุชูู ุนูู ูููุฉ ูุญุธูุฑุฉ ุญุชู ูู ูุงู ูููุง ุญุฑูู ููุฑุฑุฉ"""
    words = message.split()  # ุชูุณูู ุงูุฑุณุงูุฉ ุฅูู ูููุงุช ูููุตูุฉ
    normalized_words = [normalize_text(word) for word in words]  # ุชูุธูู ูู ูููุฉ
    
    # ุงูุชุญูู ูู ูุฌูุฏ "ููู" ูู ุฃู ูููุฉ
    for word in normalized_words:
        if "ู" * 3 in word:  # ุฅุฐุง ูุงูุช ุงููููุฉ ุชุญุชูู ุนูู ููู
            return True
    
    for banned_word in banned_words:
        if normalize_text(banned_word) in normalized_words:  # ุชุทุงุจู 100% ุจุนุฏ ุงููุนุงูุฌุฉ
            return True
    return False

@ABH.on(events.NewMessage)
async def handler(event):
    """ุงูุชุนุงูู ูุน ุงูุฑุณุงุฆู"""
    # ุงูุชุญูู ูู ุฃู ุงูุฑุณุงูุฉ ุชุฃุชู ูู ูุฌููุนุฉ
    if event.is_group:  # ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ูู ูุฌููุนุฉ
        # ุฅุถุงูุฉ ูููุงุช ูุญุธูุฑุฉ ุฌุฏูุฏุฉ ุจุงุณุชุฎุฏุงู ุนูุงูุฉ #
        if event.raw_text.startswith('#'):
            new_word = event.raw_text[1:].strip()  # ุฅุฒุงูุฉ ุงูุนูุงูุฉ #
            if new_word not in banned_words:  # ุฅุฐุง ูู ุชูู ุงููููุฉ ููุฌูุฏุฉ ูู ูุจู
                banned_words.append(new_word)  # ุฅุถุงูุชูุง ุฅูู ุงููุงุฆูุฉ
                await event.reply(f"โ ุชู ุฅุถุงูุฉ ุงููููุฉ '{new_word}' ุฅูู ูุงุฆูุฉ ุงููููุงุช ุงููุญุธูุฑุฉ!")
        
        elif check_message(event.raw_text):
            user_id = event.sender_id
            warning_msg = "๐จ **ุชุญุฐูุฑ:** ูุง ููููู ุงุณุชุฎุฏุงู ูููุงุช ูุญุธูุฑุฉ ูู ุงููุญุงุฏุซุฉ! ๐ซ"
            await event.reply(warning_msg)  # ุฅุฑุณุงู ุฑุณุงูุฉ ุชุญุฐูุฑ

            # ุชูููุฏ ุงููุฑุณู
            try:
                # ุชูููุฏ ุงููุฑุณู ูู ุฅุฑุณุงู ุงูุฑุณุงุฆู ูู ุงููุฌููุนุฉ ููุฏุฉ ุบูุฑ ูุญุฏุฏุฉ
                await event.client(EditBannedRequest(event.chat_id, user_id, send_messages=False))
                await event.reply("๐ซ ุชู ุชูููุฏู ูู ุฅุฑุณุงู ุงูุฑุณุงุฆู ูู ูุฐู ุงููุฌููุนุฉ ุจุณุจุจ ุงุณุชุฎุฏุงู ูููุงุช ูุญุธูุฑุฉ!")
            except Exception as e:
                print(f"Error while restricting user: {e}")

# ุชุดุบูู ุงูุจูุช
print("โ ุงูุจูุช ุดุบุงู ูููุชุธุฑ ุงูุฑุณุงุฆู...")
ABH.run_until_disconnected()
